<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Mini gra QR â€“ quiz + skan</title>

<style>
 body {
   font-family: Arial, sans-serif;
   padding: 16px;
   margin: 0;
   font-size: 20px;
   background: #f4f4f4;
 }

 h1 {
   font-size: 26px;
   margin-bottom: 20px;
 }

 button {
   width: 100%;
   padding: 18px;
   font-size: 22px;
   margin: 10px 0;
   border-radius: 12px;
   border: none;
   background: #007bff;
   color: white;
 }

 button:active {
   background: #0056b3;
 }

 .info {
   margin-top: 12px;
   font-weight: bold;
   font-size: 22px;
 }

 .big {
   font-size: 28px;
 }

 .green { color: green; }
 .red { color: red; }

 .blink {
   animation: blinker 0.7s linear infinite;
 }

 @keyframes blinker {
   50% { opacity: 0; }
 }

 #scanResult {
   position: fixed;
   top: 0;
   left: 0;
   width: 100%;
   height: 100%;
   display: none;
   justify-content: center;
   align-items: center;
   font-size: 56px;
   font-weight: bold;
   background: white;
   z-index: 999;
 }

 #scanResult.success {
   color: #00cc44;
 }

 #scanResult.fail {
   color: #cc0000;
 }

 /* ðŸ”´ DODAJ TO NA KOÅƒCU */
 .locked {
   background-color: #cc0000 !important;
   color: white;

 }

/* --- EFEKTY MIGANIA --- */

.flash-success {
  background-color: #00cc44 !important;
  color: black !important;
}

.flash-error {
  background-color: #ff4444 !important;
  color: black !important;
}

.locked {
  background-color: #cc0000 !important;
  color: black !important;
}

/* Komunikat centralny */
#overlayMessage {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: none;
  justify-content: center;
  align-items: center;
  font-size: 48px;
  font-weight: bold;
  z-index: 999;
}
</style></head>

<body>
						<h1>Mini gra QR - 9.6.5</h1>

<div id="screen-init">
  <p>ZeskanowaÅ‚eÅ› kod startowy.</p>
  <button id="startBtn">START</button>
</div>

<div id="screen-game" style="display:none;">
  <p class="info big" id="targetInfo"></p>
  <p class="info" id="status"></p>
  <p class="info" id="timerInfo"></p>
  <p class="info" id="historyInfo">Historia:</p>
  <p class="info">Punkty: <span id="points">0</span></p>

  <div id="quizBox"></div>
  <div id="scanResult" style="display:none;"></div>
  <div id="overlayMessage"></div>

</div>

<div id="screen-end" style="display:none;">
<h2 id="endMessage"></h2>
</div>

<script>

const overlay = document.getElementById("overlayMessage");
let history = [];
const CODES = ["A","B","C"];
let currentTarget = null;
let points = 0;
let isLocked = false;
let timeLeft = 5;
let timerInterval = null;

/* ELEMENTY */
const startBtn = document.getElementById("startBtn");
const targetInfo = document.getElementById("targetInfo");
const status = document.getElementById("status");
const timerInfo = document.getElementById("timerInfo");
const pointsEl = document.getElementById("points");

/* LOSOWANIE BEZ POWTÃ“RKI */
function pickNextTarget() {
  const available = CODES.filter(c => c !== currentTarget);
  currentTarget = available[Math.floor(Math.random() * available.length)];
  targetInfo.innerHTML = `NastÄ™pny kod: <span class="green big">${currentTarget}</span>`;
}

/* TIMER */
function startTimer() {
  clearInterval(timerInterval);
  timeLeft = 5;
  timerInfo.innerText = `Czas: ${timeLeft}s`;

  timerInterval = setInterval(() => {
    timeLeft--;
    timerInfo.innerText = `Czas: ${timeLeft}s`;

    if(timeLeft <= 0) {
      clearInterval(timerInterval);
      lockGame();
    }
  }, 1000);
}

/* BLOKADA */
function lockGame() {
  isLocked = true;
  document.body.classList.add("locked");

  overlay.style.display = "flex";
  overlay.innerText = "BLOKADA";

  if (navigator.vibrate) {
    navigator.vibrate([200,100,200,100,400]);
  }
}

/* ODBLOKOWANIE */
function unlockGame() {
  if(!isLocked) return;

  isLocked = false;
  document.body.classList.remove("locked");
  overlay.style.display = "none";
  startTimer();
}

/* SKAN */
function onScan(text) {

  let code = text.toUpperCase().trim();

  if(isLocked) {
    if(code === "UNLOCK") {
      unlockGame();
    }
    return;
  }

  if(code === currentTarget) {

    history.push(currentTarget);
    updateHistory();

    points++;
    pointsEl.innerText = points;

    flashScreen("success", "SUKCES");

    if(points >= 5) {
      setTimeout(() => endGame("Wygrana! 5 punktÃ³w"), 400);
      return;
    }

    setTimeout(() => {
      pickNextTarget();
      startTimer();
    }, 400);

  } else {
    flashScreen("error", "BÅÄ˜DNY KOD");
  }
}

/* KONIEC */
function endGame(msg) {
  clearInterval(timerInterval);
  document.getElementById("screen-game").style.display = "none";
  document.getElementById("screen-end").style.display = "block";
  document.getElementById("endMessage").innerText = msg;
}

/* START */
startBtn.onclick = async () => {

  if ('NDEFReader' in window) {
    try {
      const nfcReader = new NDEFReader();
      await nfcReader.scan();

      nfcReader.onreading = event => {
        const decoder = new TextDecoder();
        const record = event.message.records[0];
        let text = decoder.decode(record.data);
        text = text.replace(/\u0000/g, "").trim().toUpperCase();
        onScan(text);
      };

    } catch (error) {
      console.log("BÅ‚Ä…d NFC:", error);
    }
  }

  document.getElementById("screen-init").style.display = "none";
  document.getElementById("screen-game").style.display = "block";

  pickNextTarget();
  startTimer();
};

function flashScreen(type, message) {

  overlay.style.display = "flex";
  overlay.innerText = message;

  if(type === "success") {
    document.body.classList.add("flash-success");
  }

  if(type === "error") {
    document.body.classList.add("flash-error");
  }

  setTimeout(() => {
    document.body.classList.remove("flash-success");
    document.body.classList.remove("flash-error");
    overlay.style.display = "none";
  }, 400);
}

function updateHistory() {
  document.getElementById("historyInfo").innerText =
    "Historia: " + history.join(" â†’ ");
}
</script>


</body>
</html>
