<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Mini gra QR â€“ 9.7.1</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: #f4f4f4;
}

h1 { font-size: 26px; text-align:center; margin:20px 0; }

button {
  width: 100%;
  padding: 18px;
  font-size: 22px;
  margin: 20px 0;
  border-radius: 12px;
  border: none;
  background: #007bff;
  color: white;
}
button:active { background: #0056b3; }

#screen-game { display:none; text-align:center; }

#targetLetter {
  font-size: 140px;
  font-weight: bold;
  margin: 0;
  line-height: 1.2;
}

#timerInfo { font-size: 72px; margin: 10px 0; }
#pointsClock { display:flex; justify-content:space-between; font-size: 28px; padding: 0 20px; }


#overlayMessage {
  position: fixed;        /* nakÅ‚adka wzglÄ™dem okna */
  bottom: 20px;           /* 20px od dolnej krawÄ™dzi */
  left: 50%;              /* Å›rodek poziomo */
  transform: translateX(-50%);  /* dokÅ‚adne wyÅ›rodkowanie */
  font-size: 48px;        /* duÅ¼a czcionka */
  font-weight: bold;
  color: white;
  text-align: center;
  z-index: 1000;          /* Å¼eby byÅ‚a nad wszystkim */
  pointer-events: none;   /* klikniÄ™cia przechodzÄ… przez overlay */
}

.locked { background-color: #cc0000 !important; color: white !important; }
.flash-success { background-color: #00cc44 !important; color: black !important; }
.flash-error { background-color: #ff4444 !important; color: black !important; }

#screen-end { display:none; padding:20px; text-align:center; font-size:28px; }
#endMessage { font-size:48px; font-weight:bold; color:white; background-color:green; padding:20px; margin:20px 0; }
#endRoute { margin-top:20px; font-size:28px; }
</style>
</head>
<body>

																																			<h1>Mini gra QR â€“ 9.8.8</h1>

<div id="screen-init">
<label>
  Wybierz trasÄ™:
  <select id="selectRoute">
    <option value="5">Trasa 5: AAA</option>
    <option value="6">Trasa 6: BBBBBB</option>
    <option value="7">Trasa 7: CCCCCCC</option>
    <option value="8">Trasa 8: DDDDDDDD</option>
    <option value="9">Trasa 9: EEEEEEEEE</option>
    <option value="10">Trasa 10: FFFFFFFFFF</option>
    <option value="11">Trasa 11: GGGGGGGGGGG</option>
    <option value="12">Trasa 12: ABCDEFGABCDE</option>
    <option value="13">Trasa 13: BCDEFGABCDEFA</option>
    <option value="14">Trasa 14: CDEFGABCDEFGAB</option>
    <option value="15">Trasa 15: DEFGABCDEFGABC</option>
  </select>
</label>
<br><br>
  <label>
    Czas na zeskanowanie kolejnej litery w sekundach (3-60):
    <input type="number" id="inputTime" min="3" max="60" value="10">
  </label>
  <br><br>
  <button id="startBtn">START</button>
</div>

<div id="screen-game">
<p id="targetLetter"></p>
<p id="timerInfo"></p>
  <div id="pointsClock">
    <div>Punkty: <span id="points">0</span></div>
    <div>Czas gry: <span id="gameClock">00:00</span></div>
	  </div>
<p id="overlayMessage"></p> <!-- teraz poniÅ¼ej timerInfo -->
  
</div>

<div id="screen-end">
  <div id="endMessage"></div>
  <div id="endRoute"></div>
</div>

<script>
const AVAILABLE_ROUTES = {
  5: ["A","C","B","E","G"],
  6: ["F","B","D","A","G","C"],
  7: ["C","E","A","D","F","B","G"],
  8: ["B","G","D","C","F","A","E","B"],
  9: ["D","A","C","F","B","G","E","C","A"],
  10: ["E","B","D","A","G","C","F","B","D","G"],
  11: ["A","C","F","B","E","G","D","C","A","F","B"],
  12: ["G","D","B","E","C","F","A","G","C","D","B","E"],
  13: ["B","E","A","C","F","D","G","B","C","E","A","F","D"],
  14: ["C","F","A","D","B","G","E","C","F","B","D","A","E","G"],
  15: ["D","B","G","C","E","A","F","D","B","C","G","E","A","F","C"]
};
let routeIndex = 0;
let routeDirection = 1;
let currentTarget = null;
let history = [];
let points = 0;
let isLocked = false;
let timeLeft = 5;
let timerInterval = null;
let gameStartTime = null;
let gameClockInterval = null;
let gameFinished = false;
let maxPoints = 7;    // domyÅ›lnie 7 punktÃ³w
let scanTime = 10;    // domyÅ›lnie 10 sekund na literÄ™

const startBtn = document.getElementById("startBtn");
const targetLetter = document.getElementById("targetLetter");
const timerInfo = document.getElementById("timerInfo");
const pointsEl = document.getElementById("points");
const gameClockEl = document.getElementById("gameClock");
const overlay = document.getElementById("overlayMessage");
const screenInit = document.getElementById("screen-init");
const screenGame = document.getElementById("screen-game");
const screenEnd = document.getElementById("screen-end");
const endMessage = document.getElementById("endMessage");
const endRoute = document.getElementById("endRoute");

/* ===== FUNKCJE ===== */

function initializeRoute() {
  // losowa litera startowa w trasie
  routeIndex = Math.floor(Math.random() * ROUTE.length);

  // losowy kierunek: 1 = do przodu, -1 = wstecz
  routeDirection = Math.random() < 0.5 ? 1 : -1;

  currentTarget = ROUTE[routeIndex];
  history = [currentTarget];

  updateDisplay();
}

function moveToNextTarget() {
  routeIndex = (routeIndex + routeDirection + ROUTE.length) % ROUTE.length;
  currentTarget = ROUTE[routeIndex];
  history.push(currentTarget);
  updateDisplay();
}

function updateDisplay() {
  targetLetter.innerText = currentTarget;
  timerInfo.innerText = `Czas: ${timeLeft}s`;
  pointsEl.innerText = points;
}

function startTimer() {
  clearInterval(timerInterval);
  timeLeft = scanTime;  // teraz czas z pola startowego
  timerInfo.innerText = `Czas: ${timeLeft}s`;

  timerInterval = setInterval(() => {
    timeLeft--;
    timerInfo.innerText = `Czas: ${timeLeft}s`;
    if(timeLeft <=0) {
      clearInterval(timerInterval);
      lockGame();
    }
  }, 1000);
}

function lockGame() {
  isLocked = true;
  document.body.classList.add("locked");
  overlay.style.display="flex";
  overlay.innerText="BLOKADA";
  if(navigator.vibrate) navigator.vibrate([200,100,200,100,400]);
}

function unlockGame() {
  if(!isLocked) return;
  isLocked = false;
  document.body.classList.remove("locked");
  overlay.style.display="none";
  startTimer();
}

function flashScreen(type,message) {
  overlay.style.display="flex";
  overlay.innerText=message;

  if(type==="success") document.body.classList.add("flash-success");
  if(type==="error") document.body.classList.add("flash-error");

  setTimeout(()=> {
    document.body.classList.remove("flash-success");
    document.body.classList.remove("flash-error");
    if(!isLocked) overlay.style.display="none";
  },1000); // ðŸ”¥ wydÅ‚uÅ¼ony czas wyÅ›wietlania
}

function onScan(text) {
  if(gameFinished) return;

  const code = text.toUpperCase().trim();

  if(isLocked) {
    if(code==="UNLOCK") unlockGame();
    return;
  }

  if(code===currentTarget) {
    // ðŸ”¥ zatrzymanie licznika natychmiast po prawidÅ‚owym skanie
    clearInterval(timerInterval);

    points++;
    history.push(currentTarget);
    updateDisplay();

    flashScreen("success","SUKCES");

if(points >= maxPoints) {
  gameFinished = true;
  clearInterval(timerInterval);
  clearInterval(gameClockInterval);
  setTimeout(()=> {
    screenGame.style.display="none";
    screenEnd.style.display="block";
    endMessage.innerText = `WYGRANA!\nCzas: ${gameClockEl.innerText}`;
    endRoute.innerText = "Trasa: " + history.join(" â†’ ");
  },800);
  return;
}

    setTimeout(()=> {
      moveToNextTarget();
      startTimer(); // ðŸ”¥ reset nowego 5-sekundowego timera
    },1000);

  } else {
    flashScreen("error","BÅÄ˜DNY KOD");
  }
}

function startGameClock() {
  gameStartTime = Date.now();
  gameClockInterval = setInterval(() => {
    const elapsed = Date.now()-gameStartTime;
    const minutes = Math.floor(elapsed/60000);
    const seconds = Math.floor((elapsed/1000)%60);
    gameClockEl.innerText=`${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
  },200);
}

/* ===== START ===== */
startBtn.onclick = async () => {
  const timeInput = parseInt(document.getElementById("inputTime").value);
  if(timeInput >= 3 && timeInput <= 60) scanTime = timeInput;

  // ðŸ”¹ pobieramy trasÄ™ z selecta
  const routeLength = parseInt(document.getElementById("selectRoute").value);
  ROUTE.splice(0, ROUTE.length, ...AVAILABLE_ROUTES[routeLength]); // nadpisujemy ROUTE wybranÄ… trasÄ…

  // ukrycie ekranu startowego
  screenInit.style.display = "none";
  screenGame.style.display = "block";

  // start gry
  startGameClock();
  initializeRoute();
  startTimer();

  // obsÅ‚uga NFC
  if ('NDEFReader' in window) {
    try {
      const nfcReader = new NDEFReader();
      await nfcReader.scan();
      nfcReader.onreading = event => {
        for(const record of event.message.records){
          if(record.recordType === "text"){
            const decoder = new TextDecoder(record.encoding || "utf-8");
            let text = decoder.decode(record.data);
            text = text.replace(/\u0000/g,"").trim();
            onScan(text);
          }
        }
      };
    } catch(e){ console.log("BÅ‚Ä…d NFC:", e); }
  }
};
</script>
</body>
</html>







